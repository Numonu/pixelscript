---
export type Action = {
    size: number;
    src: string;
}
interface Props {
    title : string;
    actions: Action[];
}
const { actions , title } = Astro.props;
---

<style>
    .reveal {
        animation: reveal 0.2s ease;
    }
    @keyframes reveal {
        from {
            opacity: 0;
            scale: 0.8;
        }
        to {
            opacity: 1;
            scale: 1;
        }
    }
</style>
<div class="relative">
    <button
        id={`btn-${title}`}
        class="bg-zinc-800 relative px-4 py-2 text-sm uppercase rounded-md hover:bg-zinc-700 transition-colors"
    >
        <span class="mr-2"> download</span>
        <i class="fa-solid fa-chevron-down"></i>
    </button>
    <div
        style="display:none"
        id={`downloads-${title}`}
        class="bg-zinc-800 reveal absolute z-10 w-[160%] p-2 rounded-md origin-top-right right-0 bottom-0 translate-y-[105%]"
    >
        {
            actions.map((e: Action , i) => {
                return (
                    <a download={title} href={e.src} target="_blank">
                        <button class="w-full flex justify-between p-2 text-sm rounded-sm hover:bg-zinc-700 transition-colors">
                            <span class="text-neutral-100">
                                <span id={`width-${title}-${i}`}></span>
                                <span class="text-xs">x</span>
                                <span id={`height-${title}-${i}`}></span>
                            </span>
                            <span>
                            {e.size} 
                            <span class="text-xs">mb</span>
                            </span>
                        </button>
                    </a>
                );
            })
        }
    </div>
</div>

<script define:vars={{title,actions}}>
    //display dialog
    let show = true;
    const btn = document.getElementById(`btn-${title}`);
    const downloads = document.getElementById(`downloads-${title}`);

    btn?.addEventListener("click", () => {
        if (downloads) downloads.style.display = show ? "block" : "none";
        show = !show;
    });
    //img size
    window.addEventListener("load",  () => {
        actions.forEach((e,i) => {
            const width = document.getElementById(`width-${title}-${i}`);
            const height = document.getElementById(`height-${title}-${i}`);
            //
            const img = document.createElement("img");
            img.src = e.src;
            img.addEventListener("load" , () => {
                width.textContent = img.naturalWidth;
                height.textContent = img.naturalHeight;
            })
        });
    });
</script>
